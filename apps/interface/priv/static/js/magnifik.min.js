/*! mobify-maginifik 0.1.4 2015-09-23 */
!function(){var a=window.Adaptive||{},b=window.Mobify=window.Mobify||{};void 0===a.$&&(b.$=b.$||window.$||window.Zepto||window.jQuery);var c=a.$||b.$;b.UI=b.UI||{classPrefix:"m-"},b.UI.Magnifik=function(){var a={stage:void 0,classNames:{zooming:"zooming",close:"close",control:"magnifikControl",canvas:"magnifikCanvas",thumb:"magnifikThumb",full:"magnifikFull"},ratio:2,seekImage:!0,clickCloses:!0,activationEvent:"click",canvasStyle:{position:"absolute",width:"100%",height:"100%",overflow:"auto","-webkit-overflow-scrolling":"touch"},imageStyle:{position:"absolute",top:"0",left:"0",maxWidth:"none",maxHeight:"none"},stageHTML:function(){return'<div class="'+this._getClass("canvas")+'"><img class="'+this._getClass("thumb")+'"><img class="'+this._getClass("full")+'"></div>'},globalStyle:function(){var a="."+this._getClass("zooming");return a+" { overflow: hidden; }"+a+" > * { display: none !important; }"+a+" > ."+this._getClass("control")+" { display: block !important; }"}},d=function(b,e){this.options=c.extend({},d.defaults,e),this.options.classNames=c.extend(a.classNames,this.options.classNames),this.options.imageStyle.width=100*this.options.ratio+"%",this.options.stage||(this.options.stage=c("body"),this.options.global=!0),this.$element=c(b),this.bind()};return d.defaults=a,d.prototype.unbind=function(){return this.bind(!0)},d.prototype.makeElems=function(){if(this.$stage=this.options.stage,this.$canvas=c(this.options.stageHTML.call(this)).addClass(this._getClass("control")),this.$canvas.first().css(this.options.canvasStyle),this.$thumb=this.$canvas.find("."+this._getClass("thumb")).css(this.options.imageStyle),this.$full=this.$canvas.find("."+this._getClass("full")).css(this.options.imageStyle),this.options.clickCloses&&this.$canvas.first().addClass(this._getClass("close")),this.options.global){if(!c('style[data-magnifik="'+this._getClass("zooming")+'"]').length){var a=document.createElement("style"),b=this.options.globalStyle.call(this);a.setAttribute("type","text/css"),a.styleSheet?a.styleSheet.cssText=b:a.appendChild(document.createTextNode(b)),c("head")[0].appendChild(a)}}else this.$stage.css("position","relative");var d="."+this._getClass("close");this.$close=this.$canvas.find(d).add(this.$canvas.filter(d)),this.bindClose("bind")},d.prototype.close=function(a){this.isOpen&&(this.isOpen=!1,this.$element.trigger("magnifik:closing"),this.$canvas.detach(),this.$stage.removeClass(this._getClass("zooming")),this.options.global&&(document.body.scrollTop=this.oldScrollTop),this.$element.trigger("magnifik:close"))},d.prototype.open=function(a){if(a.preventDefault(),!this.isOpen){this.isOpen=!0,this.$element.trigger("magnifik:opening"),this.$stage||this.makeElems();var b,d,e,f=.5,g=.5,h=c(a.target);if("IMG"!==a.target.tagName){var i=this.$element;this.options.seekImage&&(i=i.add(this.$element.parents()));for(var j=0;j<i.length;++j)if(d=c(i[j]).find("img"),d.length){h=d;break}}else f=a.offsetX/h.prop("offsetWidth"),g=a.offsetY/h.prop("offsetHeight");b=h.filter("[href]").add(h.parent("[href]")),e=b.attr("href")||h.attr("src"),this.$thumb.attr("src",h.attr("src")),this.$full.attr("src",e),this.options.global&&(this.oldScrollTop=document.body.scrollTop),this.$stage.append(this.$canvas),this.$stage.addClass(this._getClass("zooming"));var k=h.prop("naturalHeight")/h.prop("naturalWidth"),l=this.$thumb.prop("offsetWidth"),m=this.$canvas.prop("offsetWidth"),n=l,o=this.$canvas.prop("offsetHeight"),p=l*k,q=this;q.$canvas.prop("scrollLeft",Math.max(0,Math.min(n-m,n*f-m/2))),q.$canvas.prop("scrollTop",Math.max(0,Math.min(p-o,p*g-o/2))),q.$element.trigger("magnifik:open")}},d.prototype.bindClose=function(a){this.$close&&this.$close[a](this.options.activationEvent,this.boundClose)},d.prototype.bind=function(a){var b=this,c=a?"unbind":"bind";this.boundClose=this.boundClose||function(a){return b.close.apply(b,arguments)},this.boundOpen=this.boundOpen||function(a){return b.open.apply(b,arguments)},this.$element[c](this.options.activationEvent,this.boundOpen),this.bindClose(c)},d.prototype._getClass=function(a){var c=this.options.classPrefix;return"undefined"==typeof c&&(c=b.UI.classPrefix),c+this.options.classNames[a]},d}(),c.fn.magnifik=function(a,d){var e="Mobify.UI.Magnifik",f=c.extend({},c.fn.magnifik.defaults);return"object"==typeof a&&(f=a,d=null,a=null),this.each(function(){var g=c(this),h=g.data(e);h||(h=new b.UI.Magnifik(this,f)),a&&(h[a](d),"destroy"===a&&(g.data(e,null),g.$canvas.remove())),g.data(e,h)}),this}}();